<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>UPLOAD A USER</h1>

    <form>
        <input type="file" name="logo" placeholder="Select A Photo" accept="image/*" required><br>
        <input type="text" name="logo" id="logo" value="" style="display: none;">

        <select name="type" id="type" required>
            <option value="">Select Bank Type</option>
            <option value="Commercial">Commercial</option>
            <option value="Mortgage">Primary Mortgage Bank</option>
            <option value="Merchant">Merchant Bank</option>
            <option value="Microfinance">Microfinance Bank</option>
            <option value="Payment_Service">Payment Service Bank</option>
            <option value="Mobile_Money">Mobile Money Operator</option>
            <option value="Other">Other</option>
        </select><br>

        <input type="text" name="name" id="name" value="" placeholder="Enter Bank Name"required><br>
        <input type="text" name="short" id="short" value="" placeholder="Enter Abbrev." required><br>
        <input type="number" name="ussd" id="ussd" value="" placeholder="Enter USSD code"  required><br>
        <input type="text" name="website" id="website" value="" placeholder="Enter Bank Website" required><br>
        <input type="email" name="email" id="email" value="" placeholder="Enter Bank Email" required><br>
        <input type="tel" name="phone" id="phone" value="" placeholder="Enter Bank Phone Number" required><br>
        <input type="submit" id="submit" value="Submit">
    </form>

    <script>

        const uploadImage = async () => {            
            const base64EncodedImage = document.getElementById('logo').value;
            const bankType = document.getElementById('type').value; 
            const bankName = document.getElementById('name').value;
            const bankShort = document.getElementById('short').value;
            const bankUssd = document.getElementById('ussd').value;
            const bankSite = document.getElementById('website').value;
            const bankMail = document.getElementById('email').value;
            const bankPhone = document.getElementById('phone').value;

            try {
                const res = await fetch('/api/v1/banks', {
                    
                    method: 'POST',
                    body: JSON.stringify({
                        data:base64EncodedImage, type: bankType.toLowerCase(), name: bankName, short: bankShort.toLowerCase(), ussd: bankUssd,
                        website: bankSite.toLowerCase(), email: bankMail.toLowerCase(), phone: bankPhone
                    }),
                    headers: {'Content-type': 'application/json'}
                })
                .then(response => response.json())
                    .then(data => {
                        //console.log('Success:', data);
                        alert(data.message);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        alert('Error! Something went wrong. Please try again')
                });
                
            }
            catch( error ){
                console.error(error);
            }
        }

        const button = document.querySelector('#submit');
        const input = document.querySelector('input[type="file"]');


        const form = document.querySelector('form');

        input.addEventListener('change', function (e) {
            //console.log(input.files);

            const reader = new FileReader();

            reader.onload = function() {
                const img = new Image();
                //img.src = reader.result;

                document.getElementById('logo').value = reader.result;                
                
            }

            reader.readAsDataURL(input.files[0]);

        }, false);

        
        form.addEventListener('submit', function(e){
            e.preventDefault();

            uploadImage();
                
        })
    </script>
</body>
</html>